// VS Code è°ƒè¯•é…ç½®æ¨¡æ¿
// ä½¿ç”¨æ–¹æ³•ï¼šå¤åˆ¶æ­¤æ–‡ä»¶ä¸º launch.jsonï¼ˆå³å»æ‰ .example åç¼€ï¼‰
// ä½ å¯ä»¥åœ¨ launch.json ä¸­è‡ªç”±æ·»åŠ æˆ–ä¿®æ”¹é…ç½®ï¼Œä¸ä¼šå½±å“ä»“åº“
{
  "version": "0.1.0",
  "configurations": [
    // ========== ä¸»ç¨‹åºè°ƒè¯•é…ç½® ==========
    // è°ƒè¯•ä¸»ç¨‹åºï¼ˆæ¨èï¼šä½¿ç”¨å¢é‡ç¼–è¯‘ï¼Œåªåœ¨æºç å˜åŒ–æ—¶é‡æ–°ç¼–è¯‘ï¼‰
    {
      "name": "ğŸš€ Debug Main Program",
      "type": "go",
      "request": "launch",
      "mode": "exec",
      "program": "${workspaceFolder}/bin/bililive-dev",
      "windows": {
        "program": "${workspaceFolder}/bin/bililive-dev.exe"
      },
      "args": [
        "-c",
        "${workspaceFolder}/config.yml"
      ],
      "cwd": "${workspaceFolder}",
      "preLaunchTask": "dev-incremental"
    },
    // ç›´æ¥ä»æºç è°ƒè¯•ï¼ˆæ— éœ€é¢„ç¼–è¯‘ï¼Œä½¿ç”¨ VS Code è‡ªåŠ¨ç¼–è¯‘ï¼‰
    {
      "name": "Debug Main Program (Source)",
      "type": "go",
      "request": "launch",
      "mode": "auto",
      "program": "${workspaceFolder}/src/cmd/bililive",
      "args": [
        "-c",
        "${workspaceFolder}/config.yml"
      ],
      "cwd": "${workspaceFolder}",
      "buildFlags": "-tags=dev"
    },
    // é™„åŠ åˆ°æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹
    {
      "name": "Attach to Process",
      "type": "go",
      "request": "attach",
      "mode": "local",
      "processId": "${command:pickProcess}"
    },
    // ========== æœ¬åœ°è‡ªåŠ¨å‡çº§æµ‹è¯•é…ç½® ==========
    // å¯åŠ¨ Mock ç‰ˆæœ¬ API æœåŠ¡å™¨
    {
      "name": "Mock Version API Server",
      "type": "go",
      "request": "launch",
      "mode": "auto",
      "program": "${workspaceFolder}/test/update-mock-server",
      "args": [
        "-port",
        "8888",
        "-version",
        "99.0.0"
      ],
      "cwd": "${workspaceFolder}",
      "env": {
        "MOCK_CHANGELOG": "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç‰ˆæœ¬æ›´æ–°\n\n## æ›´æ–°å†…å®¹\n- ä¿®å¤è‹¥å¹² Bug\n- æ·»åŠ æ–°åŠŸèƒ½"
      }
    },
    // è°ƒè¯•ä¸»ç¨‹åºæ›´æ–°æ£€æµ‹ï¼ˆä½¿ç”¨æœ¬åœ° Mock APIï¼‰
    // ä½¿ç”¨å¢é‡ç¼–è¯‘çš„å¯è°ƒè¯•äºŒè¿›åˆ¶ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›– API åœ°å€
    {
      "name": "Debug Main Program (Local Update Test)",
      "type": "go",
      "request": "launch",
      "mode": "exec",
      "program": "${workspaceFolder}/bin/bililive-dev",
      "windows": {
        "program": "${workspaceFolder}/bin/bililive-dev.exe"
      },
      "args": [
        "-c",
        "${workspaceFolder}/config.yml"
      ],
      "env": {
        "VERSION_API_URL": "http://localhost:8888/api/versions"
      },
      "cwd": "${workspaceFolder}",
      "preLaunchTask": "dev-incremental"
    },
    // è°ƒè¯• Launcherï¼ˆä½¿ç”¨æœ¬åœ° Mock APIï¼‰
    // æ³¨æ„ï¼šéœ€è¦å…ˆåˆ›å»º test/launcher-config-local.jsonï¼Œå¯å‚è€ƒ test/launcher-config-local.example.json
    {
      "name": "Debug Launcher (Local Update)",
      "type": "go",
      "request": "launch",
      "mode": "auto",
      "program": "${workspaceFolder}/src/cmd/launcher",
      "args": [
        "-config",
        "${workspaceFolder}/test/launcher-config-local.json",
        "-verbose"
      ],
      "cwd": "${workspaceFolder}"
    },
    // è°ƒè¯•ä¸»ç¨‹åºï¼ˆæ¨¡æ‹Ÿç”± Launcher å¯åŠ¨ï¼‰
    {
      "name": "Debug Main Program (with Launcher)",
      "type": "go",
      "request": "launch",
      "mode": "auto",
      "program": "${workspaceFolder}/src/cmd/bililive",
      "args": [
        "-c",
        "${workspaceFolder}/config.yml"
      ],
      "env": {
        "BILILIVE_LAUNCHER": "1",
        "BILILIVE_INSTANCE_ID": "debug"
      },
      "cwd": "${workspaceFolder}"
    }
  ],
  "compounds": [
    // ä¸€é”®å¯åŠ¨ï¼šä¸»ç¨‹åºæ›´æ–°æµ‹è¯•ï¼ˆMock API + ä¸»ç¨‹åºï¼‰
    // ç”¨äºæµ‹è¯•ä¸»ç¨‹åºçš„ç‰ˆæœ¬æ£€æµ‹ã€ä¸‹è½½ã€SHA256éªŒè¯ç­‰æµç¨‹
    {
      "name": "ğŸ”„ ä¸»ç¨‹åºæ›´æ–°æµ‹è¯• (Mock API + Main Program)",
      "configurations": [
        "Mock Version API Server",
        "Debug Main Program (Local Update Test)"
      ],
      "preLaunchTask": "dev-incremental",
      "stopAll": true
    },
    // ä¸€é”®å¯åŠ¨æœ¬åœ°å‡çº§æµ‹è¯•ç¯å¢ƒï¼ˆMock API + Launcherï¼‰
    // ç”¨äºæµ‹è¯• Launcher çš„è§£å‹ã€æ›¿æ¢ã€å›æ»šç­‰æµç¨‹
    {
      "name": "ğŸš€ æœ¬åœ°å‡çº§æµ‹è¯• (Mock API + Launcher)",
      "configurations": [
        "Mock Version API Server",
        "Debug Launcher (Local Update)"
      ],
      "stopAll": true
    }
  ]
}